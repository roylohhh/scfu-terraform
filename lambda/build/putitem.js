var f=(e,a)=>()=>(a||e((a={exports:{}}).exports,a),a.exports);var x=f(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.default=b;var Y=Z(require("crypto"));function Z(e){return e&&e.__esModule?e:{default:e}}function b(){return Y.default.randomBytes(16)}});var p=f(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.default=void 0;var R=[];for(m=0;m<256;++m)R[m]=(m+256).toString(16).substr(1);var m;function j(e,a){var t=a||0,r=R;return[r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]]].join("")}var ee=j;h.default=ee});var X=f(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.default=void 0;var re=I(x()),te=I(p());function I(e){return e&&e.__esModule?e:{default:e}}var H,P,D=0,N=0;function ae(e,a,t){var r=a&&t||0,n=a||[];e=e||{};var o=e.node||H,u=e.clockseq!==void 0?e.clockseq:P;if(o==null||u==null){var s=e.random||(e.rng||re.default)();o==null&&(o=H=[s[0]|1,s[1],s[2],s[3],s[4],s[5]]),u==null&&(u=P=(s[6]<<8|s[7])&16383)}var i=e.msecs!==void 0?e.msecs:new Date().getTime(),l=e.nsecs!==void 0?e.nsecs:N+1,d=i-D+(l-N)/1e4;if(d<0&&e.clockseq===void 0&&(u=u+1&16383),(d<0||i>D)&&e.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");D=i,N=l,P=u,i+=122192928e5;var _=((i&268435455)*1e4+l)%4294967296;n[r++]=_>>>24&255,n[r++]=_>>>16&255,n[r++]=_>>>8&255,n[r++]=_&255;var A=i/4294967296*1e4&268435455;n[r++]=A>>>8&255,n[r++]=A&255,n[r++]=A>>>24&15|16,n[r++]=A>>>16&255,n[r++]=u>>>8|128,n[r++]=u&255;for(var y=0;y<6;++y)n[r+y]=o[y];return a||(0,te.default)(n)}var ne=ae;g.default=ne});var z=f(c=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.default=ie;c.URL=c.DNS=void 0;var oe=ue(p());function ue(e){return e&&e.__esModule?e:{default:e}}function se(e){var a=[];return e.replace(/[a-fA-F0-9]{2}/g,function(t){a.push(parseInt(t,16))}),a}function le(e){e=unescape(encodeURIComponent(e));for(var a=new Array(e.length),t=0;t<e.length;t++)a[t]=e.charCodeAt(t);return a}var U="6ba7b810-9dad-11d1-80b4-00c04fd430c8";c.DNS=U;var k="6ba7b811-9dad-11d1-80b4-00c04fd430c8";c.URL=k;function ie(e,a,t){var r=function(n,o,u,s){var i=u&&s||0;if(typeof n=="string"&&(n=le(n)),typeof o=="string"&&(o=se(o)),!Array.isArray(n))throw TypeError("value must be an array of bytes");if(!Array.isArray(o)||o.length!==16)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var l=t(o.concat(n));if(l[6]=l[6]&15|a,l[8]=l[8]&63|128,u)for(var d=0;d<16;++d)u[i+d]=l[d];return u||(0,oe.default)(l)};try{r.name=e}catch{}return r.DNS=U,r.URL=k,r}});var K=f(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.default=void 0;var fe=de(require("crypto"));function de(e){return e&&e.__esModule?e:{default:e}}function ce(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),fe.default.createHash("md5").update(e).digest()}var ve=ce;C.default=ve});var F=f(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.default=void 0;var me=E(z()),_e=E(K());function E(e){return e&&e.__esModule?e:{default:e}}var Ae=(0,me.default)("v3",48,_e.default),ye=Ae;w.default=ye});var B=f(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.default=void 0;var he=J(x()),pe=J(p());function J(e){return e&&e.__esModule?e:{default:e}}function ge(e,a,t){var r=a&&t||0;typeof e=="string"&&(a=e==="binary"?new Array(16):null,e=null),e=e||{};var n=e.random||(e.rng||he.default)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,a)for(var o=0;o<16;++o)a[r+o]=n[o];return a||(0,pe.default)(n)}var Ce=ge;O.default=Ce});var L=f(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.default=void 0;var we=Oe(require("crypto"));function Oe(e){return e&&e.__esModule?e:{default:e}}function qe(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),we.default.createHash("sha1").update(e).digest()}var Te=qe;q.default=Te});var W=f(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.default=void 0;var Se=V(z()),Me=V(L());function V(e){return e&&e.__esModule?e:{default:e}}var xe=(0,Se.default)("v5",80,Me.default),Pe=xe;T.default=Pe});var $=f(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});Object.defineProperty(v,"v1",{enumerable:!0,get:function(){return De.default}});Object.defineProperty(v,"v3",{enumerable:!0,get:function(){return Ne.default}});Object.defineProperty(v,"v4",{enumerable:!0,get:function(){return ze.default}});Object.defineProperty(v,"v5",{enumerable:!0,get:function(){return Re.default}});var De=S(X()),Ne=S(F()),ze=S(B()),Re=S(W());function S(e){return e&&e.__esModule?e:{default:e}}});var{DynamoDBClient:He}=require("@aws-sdk/client-dynamodb"),{DynamoDBDocumentClient:Ie,BatchWriteCommand:Xe}=require("@aws-sdk/lib-dynamodb"),{v4:Ue}=$(),G=require("crypto"),ke=e=>{let a=G.randomBytes(16).toString("hex"),t=G.createHash("sha256");return t.update(JSON.stringify(e)+a),{formHash:t.digest("hex"),saltKey:a}},Ke=new He({region:"ap-southeast-2"}),Ee=Ie.from(Ke),Q=process.env.PARTICIPANT_CONSENT_TABLE,Fe=async e=>{try{if(e.httpMethod!=="POST")return{statusCode:405,headers:{"Access-Control-Allow-Origin":"http://scfu-frontend.s3-website-ap-southeast-2.amazonaws.com","Access-Control-Allow-Methods":"POST,OPTIONS","Access-Control-Allow-Headers":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:`Method not allowed: ${e.httpMethod}`})};if(!Q)return{statusCode:500,headers:{"Access-Control-Allow-Origin":"http://scfu-frontend.s3-website-ap-southeast-2.amazonaws.com","Access-Control-Allow-Methods":"POST,OPTIONS","Access-Control-Allow-Headers":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Table name is not defined in environment variables"})};let a=JSON.parse(e.body),t=a.consentForm,r=a.admin;if(!t||!r||!r.adminName)return{statusCode:400,headers:{"Access-Control-Allow-Origin":"http://scfu-frontend.s3-website-ap-southeast-2.amazonaws.com","Access-Control-Allow-Methods":"POST,OPTIONS","Access-Control-Allow-Headers":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"consentForm and admin with adminName are required."})};let n=Ue(),o=ke(t),u=[{id:n,version:0,hashMap:{formHash:o.formHash,saltKey:o.saltKey},consentForm:t,admin:r,latestVersion:1},{id:n,version:1,hashMap:{formHash:o.formHash,saltKey:o.saltKey},consentForm:t,admin:r}],s={RequestItems:{[Q]:u.map(i=>({PutRequest:{Item:i}}))}};return await Ee.send(new Xe(s)),{statusCode:200,headers:{"Access-Control-Allow-Origin":"http://scfu-frontend.s3-website-ap-southeast-2.amazonaws.com","Access-Control-Allow-Methods":"POST,OPTIONS","Access-Control-Allow-Headers":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Successfully written to table"})}}catch(a){return console.error("Error:",a),{statusCode:500,headers:{"Access-Control-Allow-Origin":"http://scfu-frontend.s3-website-ap-southeast-2.amazonaws.com","Access-Control-Allow-Methods":"POST,OPTIONS","Access-Control-Allow-Headers":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token","Access-Control-Allow-Credentials":"true"},body:JSON.stringify({message:"Internal Server Error",error:a.message})}}};module.exports={putFormItemHandler:Fe};
